--- a/build/rust/rust_bindgen.gni
+++ b/build/rust/rust_bindgen.gni
@@ -112,7 +112,6 @@
   # Calculate `_generated_bindings_rs`.
   _bindgen_outputs = get_target_outputs(":$_rust_bindgen_generator_target_name")
   _bindgen_rs_outputs = filter_include(_bindgen_outputs, [ "*.rs" ])
-  assert(len(_bindgen_rs_outputs) == 1)
   _generated_bindings_rs = _bindgen_rs_outputs[0]
 
   rust_static_library(target_name) {
--- a/build/rust/chromium_prelude/import_attribute.rs
+++ b/build/rust/chromium_prelude/import_attribute.rs
@@ -72,8 +72,8 @@
             }
         }
 
-        let gn_dir = format!("//{}", path.join("/"));
-        let mangled_crate_name = mangle_crate_name(&gn_dir, gn_name);
+        let mangled_crate_name =
+            escape_non_identifier_chars(&format!("{}:{gn_name}", path.join("/")))?;
 
         Ok(GnTarget {
             mangled_crate_name: Ident::new(&mangled_crate_name, span),
@@ -120,42 +120,52 @@
     }
 }
 
-/// Mangles a GN target path into a crate name that is globally unique
-/// ("globally" means: within a GN build graph).
+/// Escapes non-identifier characters in `symbol`.
 ///
-/// NOTE: When updating GnTarget=>CrateName mangling algorithm, it needs to
-/// be updated and kept in sync in 3 places: this function,
-/// `//build/rust/rust_target.gni`, `//build/rust/rust_static_library.gni`.
+/// Importantly, this is
+/// [an injective function](https://en.wikipedia.org/wiki/Injective_function)
+/// which means that different inputs are never mapped to the same output.
 ///
-/// # Example
+/// This is based on a similar function in
+/// https://github.com/google/crubit/blob/22ab04aef9f7cc56d8600c310c7fe20999ffc41b/common/code_gen_utils.rs#L59-L71
+/// The main differences are:
 ///
-/// ```
-/// // Calculate mangled name for the
-/// // `//build/rust/chromium_prelude:import_test_lib` GN target:
-/// let mangled = mangle_crate_name("//build/rust/chromium_prelude", "import_test_lib");
-/// assert_eq!(mangled, "import_test_lib_8086ab2e");
-/// ```
-fn mangle_crate_name(dir: &str, target_name: &str) -> String {
-    assert!(!target_name.is_empty()); // Caller is expected to verify.
-    let dir_hash = gn_string_hash(dir);
-    format!("{target_name}_{dir_hash}")
-}
+/// * Only a limited set of special characters is supported, because this makes
+///   it easier to replicate the escaping algorithm in `.gni` files, using just
+///   `string_replace` calls.
+/// * No dependency on `unicode_ident` crate means that instead of
+///   `is_xid_continue` a more restricted call to `char::is_ascii_alphanumeric`
+///   is used.
+/// * No support for escaping leading digits.
+/// * The escapes are slightly different (e.g. `/` frequently appears in GN
+///   paths and therefore here we map it to a nice `_s` rather than to `_x002f`)
+fn escape_non_identifier_chars(symbol: &str) -> Result<String, String> {
+    assert!(!symbol.is_empty()); // Caller is expected to verify.
+    if symbol.chars().next().unwrap().is_ascii_digit() {
+        return Err("Leading digits are not supported".to_string());
+    }
 
-/// `fn gn_string_hash` replicates `string_hash` from GN [1] which computes
-/// the first 8 hexadecimal digits of an SHA256 hash of a string.
-///
-/// [1] https://gn.googlesource.com/gn/+/main/docs/reference.md#func_string_hash
-fn gn_string_hash(s: &str) -> String {
-    let sha256 = {
-        let mut hasher = hmac_sha256::Hash::new();
-        hasher.update(s.as_bytes());
-        hasher.finalize()
-    };
-    let mut result = String::with_capacity(8);
-    for byte in sha256.into_iter().take(4) {
-        // `unwrap` is okay because writing into a `String` cannot fail.
-        use std::fmt::Write;
-        write!(&mut result, "{byte:02x}").unwrap();
+    // Escaping every character can at most double the size of the string.
+    let mut result = String::with_capacity(symbol.len() * 2);
+    for c in symbol.chars() {
+        // NOTE: TargetName=>CrateName mangling algorithm should be updated
+        // simultaneously in 3 places: here, //build/rust/rust_target.gni,
+        // //build/rust/rust_static_library.gni.
+        match c {
+            '_' => result.push_str("_u"),
+            '/' => result.push_str("_s"),
+            ':' => result.push_str("_c"),
+            '-' => result.push_str("_d"),
+            c if c.is_ascii_alphanumeric() => result.push(c),
+            _ => return Err(format!("Unsupported character in GN path component: `{c}`")),
+        }
     }
-    result
+    // The string replacements below are introduced to decrease the number
+    // of characters in the crate name. This is particularly important while
+    // building Chromium with lld_emit_indexes_and_imports=True, since it
+    // will potentially need to generate huge filenames, and the build will
+    // fail in some filesystems.
+    result = result.replace("third_uparty_srust_s", "_tpr");
+
+    Ok(result)
 }
--- a/build/rust/gni_impl/rust_target.gni
+++ b/build/rust/gni_impl/rust_target.gni
@@ -48,8 +48,31 @@
   if (defined(invoker.crate_name)) {
     _crate_name = invoker.crate_name
   } else {
-    _dir_hash = string_hash(get_label_info(":${_target_name}", "dir"))
-    _crate_name = "${_target_name}_${_dir_hash}"
+    # Not using `get_label_info(..., "label_no_toolchain")` to consistently
+    # use `//foo/bar:baz` instead of the alternative shorter `//foo/bar` form.
+    _dir = get_label_info(":${_target_name}", "dir")
+    _dir = string_replace(_dir, "//", "")
+    _crate_name = "${_dir}:${_target_name}"
+
+    # The `string_replace` calls below replicate the escaping algorithm
+    # from the `escape_non_identifier_chars` function in
+    # //build/rust/chromium_prelude/import_attribute.rs.  Note that the
+    # ordering of `match` branches within the Rust function doesn't matter,
+    # but the ordering of `string_replace` calls *does* matter - the escape
+    # character `_` needs to be handled first to meet the injectivity
+    # requirement (otherwise we would get `/` => `_s` => `_us` and the same
+    # result for `_s` => `_us`).
+    _crate_name = string_replace(_crate_name, "_", "_u")
+    _crate_name = string_replace(_crate_name, "/", "_s")
+    _crate_name = string_replace(_crate_name, ":", "_c")
+    _crate_name = string_replace(_crate_name, "-", "_d")
+
+    # The string replacements below are introduced to decrease the number
+    # of characters in the crate name. This is particularly important while
+    # building Chromium with lld_emit_indexes_and_imports=True, since it
+    # will potentially need to generate huge filenames, and the build will
+    # fail in some filesystems.
+    _crate_name = string_replace(_crate_name, "third_uparty_srust_s", "_tpr")
   }
   _generate_crate_root =
       defined(invoker.generate_crate_root) && invoker.generate_crate_root
--- a/build/rust/rust_static_library.gni
+++ b/build/rust/rust_static_library.gni
@@ -187,8 +187,32 @@
       if (defined(invoker.crate_name)) {
         _crate_name = invoker.crate_name
       } else {
-        _dir_hash = string_hash(get_label_info(":${_target_name}", "dir"))
-        _crate_name = "${_target_name}_${_dir_hash}"
+        # Not using `get_label_info(..., "label_no_toolchain")` to consistently
+        # use `//foo/bar:baz` instead of the alternative shorter `//foo/bar` form.
+        _dir = get_label_info(":${_target_name}", "dir")
+        _dir = string_replace(_dir, "//", "")
+        _crate_name = "${_dir}:${_target_name}"
+
+        # The `string_replace` calls below replicate the escaping algorithm
+        # from the `escape_non_identifier_chars` function in
+        # //build/rust/chromium_prelude/import_attribute.rs.  Note that the
+        # ordering of `match` branches within the Rust function doesn't matter,
+        # but the ordering of `string_replace` calls *does* matter - the escape
+        # character `_` needs to be handled first to meet the injectivity
+        # requirement (otherwise we would get `/` => `_s` => `_us` and the same
+        # result for `_s` => `_us`).
+        _crate_name = string_replace(_crate_name, "_", "_u")
+        _crate_name = string_replace(_crate_name, "/", "_s")
+        _crate_name = string_replace(_crate_name, ":", "_c")
+        _crate_name = string_replace(_crate_name, "-", "_d")
+
+        # The string replacements below are introduced to decrease the number
+        # of characters in the crate name. This is particularly important while
+        # building Chromium with lld_emit_indexes_and_imports=True, since it
+        # will potentially need to generate huge filenames, and the build will
+        # fail in some filesystems.
+        _crate_name =
+            string_replace(_crate_name, "third_uparty_srust_s", "_tpr")
       }
 
       _rlib_path = "${_output_dir}/lib${_crate_name}.rlib"
